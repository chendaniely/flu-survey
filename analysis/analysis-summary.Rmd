---
title: "Analysis summary"
output: 
  html_document:
    fig_height: 7
    keep_md: yes
    toc: yes
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, cache = T, cache.comments = T, warning = F, message = F, tidy = T, size = "small")
rm(list = ls(all.names = TRUE))
library(rmarkdown); library(knitr)
library(tidyr); library(dplyr); library(ggplot2)
library(survey); library(gridExtra)
```

```{r load-data, include=F}
## Load data variables.
load("~/git/flu-survey/data/cleaning2.RData")
load("~/git/flu-survey/data/recoding.RData")  # load "datar"
df <- datar  # contains recoded variables
```

```{r regroup-data, include=FALSE}
## income
income.map <- c(rep("under $10k", 3),
                rep("$10k to $25k", 4),
                rep("$25k to $50k", 4),
                rep("$50k to $75k", 2),
                rep("$75k to $100k", 2),
                rep("$100k to $150k", 2),
                rep("over $150k", 2))
df$income <- code(datar$PPINCIMP, income.map, "under $10k")
income.lab <- c("under $10k", "$10k to $25k", "$25k to $50k", "$50k to $75k", "$75k to $100k", "$100k to $150k", "over $150k")
df$income <- factor(df$income, levels = income.lab)

## marital staus
marital.map <- c("single", "partnered", "partnered", "single", "single", "single")
df$marital <- code(dataf$PPMARIT, marital.map, "single")

## work status
work.map <- c(rep("unemployed", 5),
              rep("employed", 2))
df$work <- code(dataf$PPWORK, work.map, "unemployed")
```

```{r survey-design}
## Create survey object.
options(digits = 4)
options(survey.lonely.psu = "adjust")

# subset data?
des <- svydesign(ids = ~1, weights = ~weight, data = df[is.na(df$weight)==F, ])
```

```{r ggplot, include=FALSE}
#### create ggplot templates ####

ptext <- theme(axis.text = element_text(size = rel(0.9)), axis.text.x = element_text(angle = 45, hjust = 1))
pgen <- aes(PPGENDER)
page <- aes(ppagect4)
peth <- aes(PPETHM)
pinc <- aes(income)
pedu <- aes(PPEDUCAT)
pwor <- aes(work)
pmar <- aes(marital)

```

## Overview:
- Default survey plot
- Univariate plots
- Bivariate plots: gender, age, ethnicity, income, education, work status, marital status
- Plot group means with error bars

# Survey Questions

## Q1. Before receiving this survey, did you know influenza is different from the stomach flu?

```{r q1-plot, fig.height=4, fig.width=5}
# default survey plot
plot(svytable(~Q1 + PPGENDER, des))

# save weighted data frame for Q1 + variables
q1 <- data.frame(svytable(~Q1 + PPGENDER + ppagecat + ppagect4 + PPETHM + income + PPEDUCAT + work + marital + PPMSACAT, des, round = T))

# ggplot objects for each question
p <- ggplot(q1, aes(Q1, weight = Freq)) + ptext
fil <- aes(fill = Q1)

# make tables with: svytable(~Q1 + PPGENDER, des, round = T)
p + geom_bar()
(gen <- p + aes(fill = PPGENDER) + geom_bar(position = "dodge"))
(age <- p + aes(fill = ppagect4) + geom_bar(position = "dodge"))
(age2 <- p + aes(ppagecat) + fil + geom_bar(position = "stack"))
(eth <- p + peth + fil + geom_bar(position = "dodge"))
(eth2 <- p + aes(fill = PPETHM) + geom_bar(position = "fill"))
(inc <- p + pinc + fil + geom_bar(position = "stack"))
(inc2 <- p + aes(fill = income) + geom_bar(position = "dodge"))
(edu <- p + pedu + fil + geom_bar(position = "dodge"))
(edu2 <- p + aes(fill = PPEDUCAT) + geom_bar(position = "dodge"))
(wor <- p + pwor + fil + geom_bar(position = "dodge"))
(wor2 <- p + aes(fill = work) + geom_bar(position = "dodge"))
(mar <- p + pmar + fil + geom_bar(position = "dodge"))
(met <- p + aes(PPMSACAT) + fil + geom_bar(position = "dodge"))
(met2 <- p + aes(fill = PPMSACAT) + geom_bar(position = "dodge"))

#grid.arrange(gen, age, eth)
#grid.arrange(inc, edu, wor, mar)

# grid plots
plot(svytable(~Q1 + PPGENDER + ppagect4, des))
plot(svytable(~Q1 + PPGENDER + PPETHM, des))
```

## Q2. Have you had an illness with influenza-like symptoms since August 2015?

```{r q2-plot}
q2 <- data.frame(svytable(~Q2 + PPGENDER + ppagecat + ppagect4 + PPETHM + income + PPEDUCAT + work + marital + PPMSACAT, des, round = T))

p <- ggplot(q2, aes(Q2, weight = Freq)) + ptext
fil <- aes(fill = Q2)

all <- p + geom_bar()
(gen <- p + pgen + fil + geom_bar(position = "dodge"))
(age <- p + page + fil + geom_bar(position = "dodge"))
(eth <- p + peth + fil + geom_bar(position = "stack"))
(inc <- p + pinc + fil + geom_bar(position = "dodge"))
(edu <- p + pedu + fil + geom_bar(position = "dodge"))
(wor <- p + pwor + fil + geom_bar(position = "dodge"))
(mar <- p + pmar + fil + geom_bar(position = "dodge"))
p + aes(PPMSACAT, fill = Q2) + geom_bar(position = "dodge")

grid.arrange(gen, age, eth)
grid.arrange(inc, edu, wor, mar)
```

#### survey example ####

```{r survey-example, eval=FALSE, include=FALSE}
### Using survey package ###

# table counts
svytable(~Q2 + PPGENDER, des, round = T)  # contingency table
svytotal(~Q2, des, na.rm = T)  # total n, SE

# svymean
svymean(~Q2, des, na.rm=T)  # with SE
svymean(~factor(Q2), des, na.rm = T)  # same as above
svymean(~interaction(Q2, PPGENDER), des, na.rm = T)  # table = 100%

# Q2 = 100%
svyby(~PPGENDER, ~Q2, des, svymean, na.rm = T)
ftable(svyby(~PPGENDER, ~Q2, des, svymean, na.rm = T))  # formatted
prop.table(svytable(~Q2 + PPGENDER, des), margin = 1)

# gender = 100%
svyby(~Q2, ~PPGENDER, des, svymean, na.rm=T)
ftable(svyby(~Q2, ~PPGENDER, des, svymean, na.rm=T))  # formatted
prop.table(svytable(~PPGENDER + Q2, des), margin = 1)

# plot gender = 100%
a <- svyby(~Q2, ~PPGENDER, des, svymean, na.rm=T)
ftable(a)  # formatted
prop.table(svytable(~PPGENDER + Q2, des), margin = 1)
barplot(a)
dotchart(a)
```

### Examine the % of US adults sick with ILI last year by sex, ethnicity, and age. Do a survey-corrected chi-square test for independence.

```{r q2-dotplots}
## create ggplot template
er <- geom_errorbar(aes(ymin = Q2Yes - se.Q2Yes, ymax = Q2Yes + se.Q2Yes), width = .25)

## % of US adults sick last year with ILI by sex
gen <- svyby(~Q2, ~PPGENDER, des, svymean, na.rm = T)
svychisq(~Q2 + PPGENDER, des)
ggplot(gen, aes(PPGENDER, Q2Yes)) + geom_point() + xlab("sex") + ylab("% sick") +
  er + ggtitle(label = "% of adults sick last year with ILI by sex") 

## % of US adults sick last year with ILI by age
age <- svyby(~Q2, ~ppagecat, des, svymean, na.rm = T)
svychisq(~Q2 + ppagecat, des)
ggplot(age, aes(ppagecat, Q2Yes)) + geom_point() + xlab("age") + ylab("% sick") +
  er + ggtitle(label = "% of adults sick last year with ILI by age") 

## % of US adults sick last year with ILI by ethnicity
eth <- svyby(~Q2, ~PPETHM, des, svymean, na.rm = T)
svychisq(~Q2 + PPETHM, des)
ggplot(eth, aes(PPETHM, Q2Yes)) + geom_point() + xlab("ethnicity") + ylab("% sick") + ptext +
  er + ggtitle(label = "% of adults sick last year with ILI by ethnicity") 

## by income
inc <- svyby(~Q2, ~PPINCIMP, des, svymean, na.rm = T)
svychisq(~Q2 + PPINCIMP, des)
ggplot(inc, aes(PPINCIMP, Q2Yes)) + geom_point() + xlab("income") + ylab("% sick") + coord_flip() +
  er + ggtitle(label = "% of adults sick last year with ILI by income") 

## by education
edu <- svyby(~Q2, ~PPEDUCAT, des, svymean, na.rm = T)
svychisq(~Q2 + PPEDUCAT, des)
ggplot(edu, aes(PPEDUCAT, Q2Yes)) + geom_point() + xlab("education") + ylab("% sick") +
  er + ggtitle(label = "% of adults sick last year with ILI by education") 

## by work status
wor <- svyby(~Q2, ~work, des, svymean, na.rm = T)
svychisq(~Q2 + work, des)
ggplot(wor, aes(work, Q2Yes)) + geom_point() + xlab("work") + ylab("% sick") +
  er + ggtitle(label = "% of adults sick last year with ILI by work") 

## by marital status
mar <- svyby(~Q2, ~PPMARIT, des, svymean, na.rm = T)
svychisq(~Q2 + PPMARIT, des)
ggplot(mar, aes(PPMARIT, Q2Yes)) + geom_point() + xlab("marital status") + ylab("% sick") +
  er + ggtitle(label = "% of adults sick last year with ILI by marital status") 

# re-grouped marital status
mar2 <- svyby(~Q2, ~marital, des, svymean, na.rm = T)
svychisq(~Q2 + marital, des)
ggplot(mar2, aes(marital, Q2Yes)) + geom_point() + xlab("") + ylab("% sick") +
  er + ggtitle(label = "% of adults sick last year with ILI by marital status") 

## by metro status
met <- svyby(~Q2, ~PPMSACAT, des, svymean, na.rm = T)
svychisq(~Q2 + PPMSACAT, des)
ggplot(met, aes(PPMSACAT, Q2Yes)) + geom_point() + xlab("metro status") + ylab("% sick") +
  er + ggtitle(label = "% of adults sick last year with ILI by metro status")

## by region cat4
reg <- svyby(~Q2, ~PPREG4, des, svymean, na.rm = T)
svychisq(~Q2 + PPREG4, des)
ggplot(reg, aes(PPREG4, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") +
  er + ggtitle(label = "% of adults sick last year with ILI by region")

## by region cat9
reg9 <- svyby(~Q2, ~ppreg9, des, svymean, na.rm = T)
svychisq(~Q2 + ppreg9, des)
ggplot(reg9, aes(ppreg9, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + ptext +
  er + ggtitle(label = "% of adults sick last year with ILI by region")

## by state
sta <- svyby(~Q2, ~PPSTATEN, des, svymean, na.rm = T)
svychisq(~Q2 + PPSTATEN, des)
ggplot(sta, aes(PPSTATEN, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + ptext + coord_flip() +
  er + ggtitle(label = "% of adults sick last year with ILI by state")

## rent status
ren <- svyby(~Q2, ~PPRENT, des, svymean, na.rm = T)
svychisq(~Q2 + PPRENT, des)
ggplot(ren, aes(PPRENT, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + ptext +
  er + ggtitle(label = "% of adults sick last year with ILI by rent")

```

## Q3. Has any other person in your household had an illness with influenza like symptoms since August 2015?

```{r q3-plot}
q3 <- as.data.frame(svytable(~Q3 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))
p <- ggplot(q3, aes(Q3, weight = Freq)) + ptext
fil <- aes(fill = Q3)

p + geom_bar()
(eth <- p + peth + fil + geom_bar(position = "fill"))

## % sick with sick household member
svychisq(~Q2 + Q3, des)
q <- svyby(~Q2, ~Q3, des, svymean, na.rm = T)
ggplot(q, aes(Q3, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + er +
  ggtitle(label = "% of adults sick vs. having sick household member ")

```

## Q4. Does your job require you to have a lot of contact with the public?

```{r q4-plot}
q4 <- as.data.frame(svytable(~Q4 + Q2 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q4, aes(Q4, weight = Freq)) + ptext
fil <- aes(fill = Q4)

p + geom_bar()
gen <- p + pgen + fil + geom_bar(position = "dodge")
age <- p + page + fil + geom_bar(position = "dodge")
eth <- p + peth + fil + geom_bar(position = "fill")
inc <- p + pinc + fil + geom_bar(position = "dodge")
edu <- p + pedu + fil + geom_bar(position = "dodge")
wor <- p + pwor + fil + geom_bar(position = "dodge")
mar <- p + pmar + fil + geom_bar(position = "dodge")
grid.arrange(gen, age)
grid.arrange(eth, inc)

## % sick plot
svychisq(~Q2 + Q4, des)
q <- svyby(~Q2, ~Q4, des, svymean, na.rm = T)
ggplot(q, aes(Q4, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + ptext + er +
  ggtitle(label = "% of adults sick and having job with public contact ") 

## now look at those sick people with high-contact jobs
svytable(~Q2 + Q4, des)
# subset q4
psub <- ggplot(q4[q4$Q4 == 'Yes', ], aes(Q4, weight = Freq)) + ptext
# being sick by gender
psub + pgen + aes(fill = Q2) + geom_bar(position = "fill") + ggtitle("People with high-contact jobs vs. being sick")
# by ethnicity
psub + peth + aes(fill = Q2) + geom_bar(position = "fill") + ggtitle("People with high-contact jobs vs. being sick")

```

## Q5. Do you have a car that you can use to travel to work?

```{r q5-plot}
q5 <- as.data.frame(svytable(~Q5 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q5, aes(Q5, weight = Freq)) + ptext
p + geom_bar()

```

## Q6. Do you regularly use public transportation?

```{r}
q6 <- as.data.frame(svytable(~Q6 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q6, aes(Q6, weight = Freq)) + ptext
fil <- aes(fill = Q6)

p + geom_bar()
gen <- p + pgen + fil + geom_bar(position = "dodge")
age <- p + page + fil + geom_bar(position = "dodge")
eth <- p + peth + fil + geom_bar(position = "dodge") + coord_flip()
inc <- p + pinc + fil + geom_bar(position = "dodge")
edu <- p + pedu + fil + geom_bar(position = "dodge")
wor <- p + pwor + fil + geom_bar(position = "dodge")
mar <- p + pmar + fil + geom_bar(position = "dodge")
# add metro status

grid.arrange(gen, age, eth)
grid.arrange(inc, edu, wor, mar)

## % sick plot
svychisq(~Q2 + Q6, des)
q <- svyby(~Q2, ~Q6, des, svymean, na.rm = T)
ggplot(q, aes(Q6, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + er +
  ggtitle(label = "% of adults sick and frequent public transportation use") 

```




## Q7. What types of public transportation do you regularly use?

```{r, eval=FALSE, include=FALSE}
#names(df)

q7 <- df %>%
  select(CaseID, PPGENDER, ppagect4, PPETHM, income, PPEDUCAT, work, marital, Q7_1:Q7_7, weight) %>%
  gather(Q7_q, Q7_r, Q7_1:Q7_7, na.rm = F)

head(q7)




###########################
# template
as.data.frame(svytable(~Q7_1, des, round = T))

p <- ggplot(q9, aes(Q9, weight = Freq)) + ptext
p + geom_bar()


#############################
# make long data
df %>%
  gather(Q7_q, Q7_r, Q7_1_Bus:Q7_7_Other) %>%
  summarise(n = count())

with(q7_long, table(Q7_q, Q7_r))

q7_long %>%
  group_by(Q7_q, Q7_r, PPGENDER, PPETHM, PPINCIMP, ppagecat) %>%
  summarise(n = count())

ggplot(q7[!is.na(q7$Q7_r), ], aes(x = Q7_r, y = n, fill = Q7_r)) +
  geom_bar(stat = 'identity', position = position_dodge()) + facet_wrap(~Q7_q) + coord_flip()

# testing plot
ggplot(q7[!is.na(q7$Q7_r), ], aes(x = Q7_r, y = n, fill = Q7_r)) +
  geom_bar(stat = 'identity') +
  facet_grid(Q7_q ~ PPGENDER)

```



## Q8. For what types of activities do you regularly use public transportation?

## Q9. Do other members of your household regularly use public transportation?

```{r q9-plot}
q9 <- as.data.frame(svytable(
  ~Q9 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q9, aes(Q9, weight = Freq)) + ptext
p + geom_bar()

```

## Q10. What types of public transportation do other members of your household regularly use?

## Q11. How do you rate your risk of getting influenza if you visited each of the following locations?

## Q12. Which of the following actions do you take to avoid getting sick?

## Q13. Do you get the flu vaccine?

```{r q13-plot}
q13 <- as.data.frame(svytable(
  ~Q13 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q13, aes(Q13, weight = Freq)) + ptext
fil <- aes(fill = Q13)

p + geom_bar()
gen <- p + pgen + fil + geom_bar(position = "dodge")
age <- p + page + fil + geom_bar(position = "dodge")
eth <- p + peth + fil + geom_bar(position = "dodge") + coord_flip()
inc <- p + pinc + fil + geom_bar(position = "dodge")
edu <- p + pedu + fil + geom_bar(position = "dodge")
wor <- p + pwor + fil + geom_bar(position = "dodge")
mar <- p + pmar + fil + geom_bar(position = "dodge")

grid.arrange(gen, age, eth)
grid.arrange(inc, edu, wor, mar)

## sick plot
svychisq(~Q2 + Q13, des)
q <- svyby(~Q2, ~Q13, des, svymean, na.rm = T)
ggplot(q, aes(Q13, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + er +
  ggtitle(label = "% of adults sick and getting flu vaccine") 

```

## Q14. How much do you pay to get an influenza vaccine?

```{r}
q14 <- as.data.frame(svytable(
  ~Q14 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q14, aes(Q14, weight = Freq)) + ptext
fil <- aes(fill = Q14)

p + geom_bar()
gen <- p + pgen + fil + geom_bar(position = "dodge")
age <- p + page + fil + geom_bar(position = "dodge")
eth <- p + peth + fil + geom_bar(position = "dodge") + coord_flip()
inc <- p + pinc + fil + geom_bar(position = "dodge")
edu <- p + pedu + fil + geom_bar(position = "dodge")
wor <- p + pwor + fil + geom_bar(position = "dodge")
mar <- p + pmar + fil + geom_bar(position = "dodge")

grid.arrange(gen, age, eth)
grid.arrange(inc, edu, wor, mar)

```

## Q15. Are you more likely to get a vaccine if others around you get a vaccine?

```{r}
q15 <- as.data.frame(svytable(
  ~Q15 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q15, aes(Q15, weight = Freq)) + ptext
fil <- aes(fill = Q15)

p + geom_bar()
gen <- p + pgen + fil + geom_bar(position = "dodge")
age <- p + page + fil + geom_bar(position = "dodge")
eth <- p + peth + fil + geom_bar(position = "dodge") + coord_flip()
inc <- p + pinc + fil + geom_bar(position = "dodge")
edu <- p + pedu + fil + geom_bar(position = "dodge")
wor <- p + pwor + fil + geom_bar(position = "dodge")
mar <- p + pmar + fil + geom_bar(position = "dodge")

grid.arrange(gen, age, eth)
grid.arrange(inc, edu, wor, mar)

```

## Q16. Are you more likely to get a vaccine if others around you do not get a vaccine?

```{r}
q16 <- as.data.frame(svytable(
  ~Q16 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q16, aes(Q16, weight = Freq)) + ptext
fil <- aes(fill = Q16)

p + geom_bar()
gen <- p + pgen + fil + geom_bar(position = "dodge")
age <- p + page + fil + geom_bar(position = "dodge")
eth <- p + peth + fil + geom_bar(position = "dodge") + coord_flip()
inc <- p + pinc + fil + geom_bar(position = "dodge")
edu <- p + pedu + fil + geom_bar(position = "dodge")
wor <- p + pwor + fil + geom_bar(position = "dodge")
mar <- p + pmar + fil + geom_bar(position = "dodge")

grid.arrange(gen, age, eth)
grid.arrange(inc, edu, wor, mar)
```

## Q17. Do you get a vaccine to protect yourself, protect others, or protect yourself and others?

```{r}
q17 <- as.data.frame(svytable(
  ~Q17 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q17, aes(Q17, weight = Freq)) + ptext
fil <- aes(fill = Q17)

p + geom_bar()
gen <- p + pgen + fil + geom_bar(position = "dodge")
age <- p + page + fil + geom_bar(position = "dodge")
eth <- p + peth + fil + geom_bar(position = "dodge") + coord_flip()
inc <- p + pinc + fil + geom_bar(position = "dodge")
edu <- p + pedu + fil + geom_bar(position = "dodge")
wor <- p + pwor + fil + geom_bar(position = "dodge")
mar <- p + pmar + fil + geom_bar(position = "dodge")

grid.arrange(gen, age, eth)
grid.arrange(inc, edu, wor, mar)
```

## Q18. What are the reasons you would not get an influenza vaccine?

## Q19. Do you have health insurance?

```{r}
q19 <- as.data.frame(svytable(
  ~Q19 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q19, aes(Q19, weight = Freq)) + ptext
fil <- aes(fill = Q19)

p + geom_bar()
gen <- p + pgen + fil + geom_bar(position = "dodge")
age <- p + page + fil + geom_bar(position = "dodge")
eth <- p + peth + fil + geom_bar(position = "dodge") + coord_flip()
inc <- p + pinc + fil + geom_bar(position = "dodge")
edu <- p + pedu + fil + geom_bar(position = "dodge")
wor <- p + pwor + fil + geom_bar(position = "dodge")
mar <- p + pmar + fil + geom_bar(position = "dodge")

grid.arrange(gen, age, eth)
grid.arrange(inc, edu, wor, mar)

## sick plot
q <- svyby(~Q2, ~Q19, des, svymean, na.rm = T)
ggplot(q, aes(Q19, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + er +
  ggtitle(label = "% of adults sick and having health insurance ") 

```

## Q20. How effective do you think the influenza vaccine is in protecting people from becoming sick with influenza?

```{r}
q20 <- as.data.frame(svytable(
  ~Q20 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q20, aes(Q20, weight = Freq)) + ptext
fil <- aes(fill = Q20)

p + geom_bar()
gen <- p + pgen + fil + geom_bar(position = "dodge")
age <- p + page + fil + geom_bar(position = "dodge")
eth <- p + peth + fil + geom_bar(position = "dodge") + coord_flip()
inc <- p + pinc + fil + geom_bar(position = "dodge")
edu <- p + pedu + fil + geom_bar(position = "dodge")
wor <- p + pwor + fil + geom_bar(position = "dodge")
mar <- p + pmar + fil + geom_bar(position = "dodge")

grid.arrange(gen, age, eth)
grid.arrange(inc, edu, wor, mar)

## sick plot
svychisq(~Q2 + Q20, des)
q <- svyby(~Q2, ~Q20, des, svymean, na.rm = T)
ggplot(q, aes(Q20, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + ptext + er +
  ggtitle(label = "% of adults sick vs. perception of flu vaccine efficacy") 

```

## Q21. Are influenza vaccines covered by your health insurance?

```{r}
q21 <- as.data.frame(svytable(
  ~Q21 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q21, aes(Q21, weight = Freq)) + ptext
p + geom_bar()

```

### Q22. Do you do any of the following when you have influenza symptoms?

### Q23. Which of the following actions do you take when you have influenza symptoms to avoid someone else from getting sick?

### Q24. What sources of information do you recall hearing or seeing about influenza outbreaks?

### Q25. If you received information from the news, internet or other public media that there was an influenza outbreak in your community would you do any of the following?

## Q26. Does your household have children?

```{r}
q26 <- as.data.frame(svytable(
  ~Q26 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q26, aes(Q26, weight = Freq)) + ptext
p + geom_bar()

## plot means
svychisq(~Q2 + Q26, des)
q <- svyby(~Q2, ~Q26, des, svymean, na.rm = T)
ggplot(q, aes(Q26, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + er +
  ggtitle(label = "% of adults sick and having children in household") 
```

### Q27. What actions do you take when a child in your household has influenza symptoms?

## Q28. Are you a single parent?

```{r}
q28 <- as.data.frame(svytable(
  ~Q28 + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))

p <- ggplot(q28, aes(Q28, weight = Freq)) + ptext
p + geom_bar()


## plot means
svychisq(~Q2 + Q28, des)
q <- svyby(~Q2, ~Q28, des, svymean, na.rm = T)
ggplot(q, aes(Q28, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") + er +
  ggtitle(label = "% of adults sick and being single parent") 

```

### Q29. How do you care for a sick child? (married parent)

### Q30. How do you care for a sick child? (single parent)

### Q31. How many hours of screen time (time spent watching television, a computer, smartphone, iPad, etc.) do you spend each day on average when you are not sick? Enter 0 if none

```{r}
# histogram


```

### Q32. How many hours of screen time do you spend each day on average when you are sick? Enter 0 if none

```{r}
# histogram


```

### Q33. How many people, including yourself, reside in your household?

```{r}
# histogram


```


------
### TEMPLATE ###
```{r, eval=FALSE, include=FALSE}
# q <- as.data.frame(svytable(~Q + PPGENDER + ppagect4 + PPETHM + income + PPEDUCAT + work + marital, des, round = T))
# 
# p <- ggplot(q, aes(Q, weight = Freq)) + ptext
# fil <- aes(fill = Q20)
# 
# p + geom_bar()
# gen <- p + pgen + fil + geom_bar(position = "dodge")
# age <- p + page + fil + geom_bar(position = "dodge")
# eth <- p + peth + fil + geom_bar(position = "dodge") + coord_flip()
# inc <- p + pinc + fil + geom_bar(position = "dodge")
# edu <- p + pedu + fil + geom_bar(position = "dodge")
# wor <- p + pwor + fil + geom_bar(position = "dodge")
# mar <- p + pmar + fil + geom_bar(position = "dodge")
#
# grid.arrange(gen, age, eth)
# grid.arrange(inc, edu, wor, mar)

# er <- geom_errorbar(aes(ymin = Q2Yes - se.Q2Yes, ymax = Q2Yes + se.Q2Yes), width = .25)
## plotting means with error bars
q <- svyby(~Q2, ~PPGENDER, des, svymean, na.rm = T)
ggplot(q, aes(PPGENDER, Q2Yes)) + geom_point() + xlab(" ") + ylab("% sick") +
  geom_errorbar(aes(ymin = Q2Yes - se.Q2Yes, ymax = Q2Yes + se.Q2Yes), width = .25) +
  ggtitle(label = "% of adults sick and ") 

```

